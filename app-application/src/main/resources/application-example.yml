# BlueCone Application - 配置示例模板
# 
# 说明：
# 1. 此文件为配置结构示例，所有敏感信息已脱敏
# 2. 本地开发请复制此文件为 application-local.yml（已加入 .gitignore）
# 3. 生产环境请使用环境变量注入敏感配置

server:
  port: 80

spring:
  application:
    name: bluecone-app
  flyway:
    # Flyway 迁移校验：开启后会在迁移前校验脚本完整性，确保可重复、可校验
    validate-on-migrate: true

  datasource:
    # 数据库连接：请通过环境变量 DB_URL 注入，或使用 application-local.yml
    url: ${DB_URL:jdbc:mysql://localhost:3306/bluecone?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-timeout: 30000

  data:
    redis:
      # Redis 连接：请通过环境变量注入
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      database: ${REDIS_DATABASE:0}
      username: ${REDIS_USERNAME:}
      password: ${REDIS_PASSWORD:}

mybatis-plus:
  enabled: true

bluecone:
  cache:
    l1:
      max-size: 20000
    l2:
      enabled: true
    consistency:
      redis:
        enabled: true
    profiles:
      user-profile:
        ttl-seconds: 600
        cache-null: true
      order-detail:
        ttl-seconds: 180
        strong-consistency: true
      tenant-config:
        ttl-seconds: 1800
        cache-null: false

  outbox:
    enabled: true
    publish-cron: "0/5 * * * * ?"    # 调试时 5 秒扫描一次
    clean-cron: "0 0 3 * * ?"        # 每日 3 点清理 DONE/DEAD
    max-retries: 5
    base-delay-seconds: 1
    max-delay-seconds: 300
    backoff-multiplier: 2.0
    dispatch-batch-size: 100
    clean-retention-days: 7
    consumption-dedup-days: 7

  storage:
    provider: ALIYUN_OSS
    aliyun:
      # OSS 配置：请通过环境变量注入访问密钥
      endpoint: ${OSS_ENDPOINT:https://oss-cn-hangzhou.aliyuncs.com}
      access-key-id: ${OSS_ACCESS_KEY_ID:}
      access-key-secret: ${OSS_ACCESS_KEY_SECRET:}
      default-bucket: ${OSS_BUCKET:bluecone}
      default-expire-seconds: 600
      cdn-domain: ${OSS_CDN_DOMAIN:https://cdn.bluecone.com}
      public-domain: ${OSS_PUBLIC_DOMAIN:https://img.bluecone.com}

  resource:
    quota:
      default-daily-upload-count-limit: 2000
      default-daily-upload-bytes-limit: 10737418240
      tenant-overrides:
        1001:
          daily-upload-count-limit: 10000
          daily-upload-bytes-limit: 53687091200
        1002:
          daily-upload-count-limit: 500
          daily-upload-bytes-limit: 1073741824

  log:
    enabled: false

  id:
    long:
      enabled: true
      node-id: 1

# 微信开放平台配置
wechat:
  open-platform:
    # 是否启用微信开放平台功能（本地开发可设为 false 使用 Stub）
    enabled: ${WECHAT_OPEN_PLATFORM_ENABLED:true}
    # 第三方平台 appid
    component-app-id: ${WECHAT_COMPONENT_APP_ID:}
    # 第三方平台 appsecret
    component-app-secret: ${WECHAT_COMPONENT_APP_SECRET:}
    # 消息校验 Token
    component-token: ${WECHAT_COMPONENT_TOKEN:}
    # 消息加解密 Key
    component-aes-key: ${WECHAT_COMPONENT_AES_KEY:}
  wxjava:
    # 是否启用 WxJava SDK（与 open-platform.enabled 保持一致）
    enabled: ${WECHAT_WXJAVA_ENABLED:true}

logging:
  level:
    com.bluecone.app.infra.outbox: WARN
