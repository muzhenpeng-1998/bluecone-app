# BlueCone Application - 开发环境配置
# 
# 说明：
# - 此文件为开发环境配置骨架，所有敏感信息通过环境变量注入
# - 此文件仅包含占位符，不包含任何真实密钥或密码
# - 在微信云托管等部署环境中，通过环境变量配置所有敏感信息
#
# 安全要求：
# - 所有敏感配置必须通过环境变量注入，不允许硬编码
# - 如果环境变量未设置，应用启动将失败（这是预期的安全行为）
# - 此文件可以提交到版本库，因为不包含真实密钥

spring:
  # Flyway 数据库迁移配置：开发环境使用严格模式
  flyway:
    # 迁移校验：强制开启，确保迁移脚本的完整性和可重复性
    # 安全原因：开发环境必须保证迁移脚本的完整性，避免数据库状态不一致
    # 风险：如果数据库状态与迁移脚本不一致，应用启动将失败（这是预期的安全行为）
    validate-on-migrate: true
    # 历史库处理：如果数据库已有数据但未使用 Flyway，自动创建 baseline
    # 可运维性：支持从已有数据库迁移到 Flyway 管理
    baseline-on-migrate: true
    # 允许乱序执行迁移（处理历史库中缺失的旧迁移脚本）
    # 可回滚性：允许在历史库中补充缺失的迁移脚本
    out-of-order: true
    # 注意：开发环境禁止忽略缺失迁移，必须保证迁移脚本的完整性
    # 原因：开发环境必须保证迁移脚本的完整性和可重复性，禁止忽略缺失迁移
    # 如果数据库中有但本地没有的迁移，应用启动将失败（这是预期的安全行为）

  # 数据源配置：所有敏感信息通过环境变量注入，无默认值
  datasource:
    # 数据库连接 URL：通过环境变量 DB_URL 注入，无默认值（安全：避免意外使用默认连接）
    url: ${DB_URL:}
    # 数据库用户名：通过环境变量 DB_USERNAME 注入，无默认值（安全：避免使用默认账号）
    username: ${DB_USERNAME:}
    # 数据库密码：通过环境变量 DB_PASSWORD 注入，无默认值（安全：密码必须显式配置）
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    # 连接池配置：开发环境可以使用较小的连接池
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-timeout: 30000

  # Redis 配置：所有敏感信息通过环境变量注入
  data:
    redis:
      # Redis 主机地址：通过环境变量 REDIS_HOST 注入，无默认值（安全：避免使用默认地址）
      host: ${REDIS_HOST:}
      # Redis 端口：通过环境变量 REDIS_PORT 注入，无默认值（安全：避免使用默认端口）
      port: ${REDIS_PORT:}
      # Redis 数据库编号：通过环境变量 REDIS_DATABASE 注入，无默认值
      database: ${REDIS_DATABASE:}
      # Redis 用户名：通过环境变量 REDIS_USERNAME 注入（可选，无默认值）
      username: ${REDIS_USERNAME:}
      # Redis 密码：通过环境变量 REDIS_PASSWORD 注入，无默认值（安全：密码必须显式配置）
      password: ${REDIS_PASSWORD:}

# BlueCone 应用自定义配置
bluecone:
  # 安全配置：JWT Token 和 Gateway 签名密钥
  security:
    token:
      # JWT 签名密钥：通过环境变量 JWT_SECRET 注入，无默认值（安全：密钥必须显式配置）
      # 风险：如果未配置，应用启动将失败（这是预期的安全行为）
      secret: ${JWT_SECRET:}
      access-token-ttl-minutes: 15
      refresh-token-ttl-days: 7
  
  # Gateway 配置
  gateway:
    enabled: true
    # Gateway 签名密钥：通过环境变量 GATEWAY_SIGNATURE_SECRET 注入，无默认值（安全：密钥必须显式配置）
    # 风险：如果未配置，应用启动将失败（这是预期的安全行为）
    signature-secret: ${GATEWAY_SIGNATURE_SECRET:}
    signature-tolerance-seconds: 300

  # 缓存配置：开发环境启用 Redis 缓存
  cache:
    l1:
      max-size: 20000
    l2:
      enabled: true
    consistency:
      redis:
        enabled: true
    profiles:
      user-profile:
        ttl-seconds: 600
        cache-null: true
      order-detail:
        ttl-seconds: 180
        strong-consistency: true
      tenant-config:
        ttl-seconds: 1800
        cache-null: false

  # Outbox 事件发布配置：开发环境使用默认配置
  outbox:
    enabled: true
    publish-cron: "0/5 * * * * ?"    # 调试时 5 秒扫描一次
    clean-cron: "0 0 3 * * ?"        # 每日 3 点清理 DONE/DEAD
    max-retries: 5
    base-delay-seconds: 1
    max-delay-seconds: 300
    backoff-multiplier: 2.0
    dispatch-batch-size: 100
    clean-retention-days: 7
    consumption-dedup-days: 7

  # 对象存储配置：所有敏感信息通过环境变量注入
  storage:
    provider: ALIYUN_OSS
    aliyun:
      # OSS 端点地址：通过环境变量 OSS_ENDPOINT 注入，无默认值（安全：避免使用默认端点）
      endpoint: ${OSS_ENDPOINT:}
      # OSS Access Key ID：通过环境变量 OSS_ACCESS_KEY_ID 注入，无默认值（安全：密钥必须显式配置）
      access-key-id: ${OSS_ACCESS_KEY_ID:}
      # OSS Access Key Secret：通过环境变量 OSS_ACCESS_KEY_SECRET 注入，无默认值（安全：密钥必须显式配置）
      access-key-secret: ${OSS_ACCESS_KEY_SECRET:}
      # OSS 默认 Bucket：通过环境变量 OSS_BUCKET 注入，无默认值（安全：避免使用默认 Bucket）
      default-bucket: ${OSS_BUCKET:}
      default-expire-seconds: 600
      # OSS CDN 域名：通过环境变量 OSS_CDN_DOMAIN 注入，无默认值
      cdn-domain: ${OSS_CDN_DOMAIN:}
      # OSS 公共域名：通过环境变量 OSS_PUBLIC_DOMAIN 注入，无默认值
      public-domain: ${OSS_PUBLIC_DOMAIN:}

  # 资源配额配置：开发环境使用默认配置
  resource:
    quota:
      default-daily-upload-count-limit: 2000
      default-daily-upload-bytes-limit: 10737418240
      tenant-overrides:
        1001:
          daily-upload-count-limit: 10000
          daily-upload-bytes-limit: 53687091200
        1002:
          daily-upload-count-limit: 500
          daily-upload-bytes-limit: 1073741824

  # 日志配置：开发环境可以启用日志
  log:
    enabled: false

  # ID 生成配置：开发环境使用默认配置
  id:
    long:
      enabled: true
      node-id: 1

# 日志级别配置：开发环境可以使用 INFO 级别
logging:
  level:
    com.bluecone.app: INFO
    com.bluecone.app.infra.outbox: WARN
