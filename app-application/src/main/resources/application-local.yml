# BlueCone Application - 本地开发配置模板
# 
# 使用说明：
# 1. 复制此文件为 application-local.yml（已加入 .gitignore，不会被提交）
# 2. 填入您的本地数据库、Redis、OSS 等配置信息
# 3. 启动时使用 profile=local：mvn spring-boot:run -Dspring-boot.run.profiles=local

spring:
  datasource:
    # 本地 MySQL 连接信息（请根据实际情况修改）
    url: ${DB_URL:jdbc:mysql://localhost:3306/bluecone?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  flyway:
    enabled: true
    baseline-on-migrate: true
    out-of-order: true
    ignore-migration-patterns: "*:missing"
    validate-on-migrate: false
    clean-disabled: false

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      database: ${REDIS_DATABASE:0}
      username: ${REDIS_USERNAME:}
      password: ${REDIS_PASSWORD:}

bluecone:
  cache:
    # 本地开发：禁用 Redis 一致性总线，使用 NoopConsistencyBus（单机模式）
    # 如果需要测试 Redis 功能，可以启动本地 Redis 并设置 enabled: true
    consistency:
      redis:
        enabled: false
    # 本地开发：也可以禁用 L2 缓存（Redis），仅使用 L1 缓存（内存）
    l2:
      enabled: false
    # 缓存失效事件配置
    invalidation:
      enabled: true
      transport: INPROCESS  # 本地开发使用进程内传输
  
  storage:
    aliyun:
      # OSS 配置（本地开发可留空，如需测试文件上传功能请填入）
      endpoint: https://oss-cn-hangzhou.aliyuncs.com
      access-key-id: your_access_key_id
      access-key-secret: your_access_key_secret
      default-bucket: bluecone-dev
  
  # Ops Console 配置（用于运维监控页面）
  ops:
    console:
      enabled: true
      token: "dev-token-123"  # 开发环境 token（线上访问时需要提供此 token）
      allowLocalhost: true    # 允许本地访问绕过 token 验证（开发方便）
      allowQueryToken: true   # 允许通过 URL 参数传递 token（?token=xxx）
      cacheTtl: PT2S          # 缓存 TTL 2秒

