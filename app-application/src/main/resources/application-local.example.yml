# BlueCone Application - 本地开发配置示例
# 
# 使用说明：
# 1. 复制此文件为 application-local.yml（已加入 .gitignore，不会被提交到版本库）
# 2. 填入您的本地数据库、Redis、OSS 等配置信息
# 3. 启动时使用 profile=local：mvn spring-boot:run -Dspring-boot.run.profiles=local
#    或：java -jar target/bluecone-app.jar --spring.profiles.active=local
#
# 安全说明：
# - 此文件包含示例值（占位符），请替换为您的实际配置
# - application-local.yml 已在 .gitignore 中，不会被提交到版本库
# - 本地开发可以使用硬编码值，但建议使用环境变量（便于切换不同环境）

spring:
  # 数据源配置：本地开发可以使用硬编码值或环境变量
  datasource:
    # 本地 MySQL 连接信息（请根据实际情况修改）
    # 方式1：直接硬编码（仅本地开发）
    url: jdbc:mysql://localhost:3306/bluecone?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
    username: root
    password: your_local_password
    # 方式2：使用环境变量（推荐，便于切换环境）
    # url: ${DB_URL:jdbc:mysql://localhost:3306/bluecone?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8}
    # username: ${DB_USERNAME:root}
    # password: ${DB_PASSWORD:your_local_password}
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  # Flyway 配置：本地开发允许容错配置
  flyway:
    # 历史库处理：如果数据库是全新库，可以重置 Flyway 历史
    # 可运维性：执行 docs/RESET-FLYWAY-HISTORY.sql 后，Flyway 会重新执行所有迁移
    baseline-on-migrate: true
    # 允许乱序执行迁移（处理历史库中缺失的旧迁移脚本）
    # 可回滚性：允许在历史库中补充缺失的迁移脚本
    out-of-order: true
    # 本地容错：允许忽略缺失的迁移脚本（如果数据库中有但本地没有的迁移）
    # 风险说明：此配置仅用于本地开发，允许数据库状态与代码不完全一致
    # 原因：本地开发可能使用不完整的数据库状态，需要容错以避免启动失败
    ignore-migration-patterns: "*:missing"
    # 本地容错：关闭迁移校验，允许本地快速迭代
    # 风险说明：此配置仅用于本地开发，生产环境必须开启校验
    # 原因：本地开发时可能频繁修改迁移脚本，关闭校验可以加快开发速度
    validate-on-migrate: false

  # Redis 配置：本地开发可以使用硬编码值或环境变量
  data:
    redis:
      # 本地 Redis 连接信息（请根据实际情况修改）
      # 方式1：直接硬编码（仅本地开发）
      host: localhost
      port: 6379
      database: 0
      username: 
      password: 
      # 方式2：使用环境变量（推荐，便于切换环境）
      # host: ${REDIS_HOST:localhost}
      # port: ${REDIS_PORT:6379}
      # database: ${REDIS_DATABASE:0}
      # username: ${REDIS_USERNAME:}
      # password: ${REDIS_PASSWORD:}

# BlueCone 应用自定义配置
bluecone:
  # 安全配置：本地开发可以使用默认值或环境变量
  security:
    token:
      # JWT 签名密钥：本地开发可以使用默认值，生产环境必须配置
      # 方式1：直接硬编码（仅本地开发）
      secret: bluecone-dev-secret-please-override-32ch
      # 方式2：使用环境变量（推荐）
      # secret: ${JWT_SECRET:bluecone-dev-secret-please-override-32ch}
      access-token-ttl-minutes: 15
      refresh-token-ttl-days: 7
  
  # Gateway 配置：本地开发可以使用默认值
  gateway:
    enabled: true
    # Gateway 签名密钥：本地开发可以使用默认值，生产环境必须配置
    # 方式1：直接硬编码（仅本地开发）
    signature-secret: bluecone-signature-dev
    # 方式2：使用环境变量（推荐）
    # signature-secret: ${GATEWAY_SIGNATURE_SECRET:bluecone-signature-dev}
    signature-tolerance-seconds: 300

  # 缓存配置：本地开发可以禁用 Redis 相关功能
  cache:
    l1:
      max-size: 20000
    # 本地开发：可以禁用 L2 缓存（Redis），仅使用 L1 缓存（内存）
    # 原因：如果本地没有启动 Redis，可以禁用 L2 缓存以避免连接错误
    l2:
      enabled: false
    consistency:
      # 本地开发：禁用 Redis 一致性总线，使用 NoopConsistencyBus（单机模式）
      # 原因：如果本地没有启动 Redis，可以禁用一致性总线以避免连接错误
      # 如果需要测试 Redis 功能，可以启动本地 Redis 并设置 enabled: true
      redis:
        enabled: false
    profiles:
      user-profile:
        ttl-seconds: 600
        cache-null: true
      order-detail:
        ttl-seconds: 180
        strong-consistency: true
      tenant-config:
        ttl-seconds: 1800
        cache-null: false

  # Outbox 事件发布配置：本地开发可以使用默认配置
  outbox:
    enabled: true
    publish-cron: "0/5 * * * * ?"    # 调试时 5 秒扫描一次
    clean-cron: "0 0 3 * * ?"        # 每日 3 点清理 DONE/DEAD
    max-retries: 5
    base-delay-seconds: 1
    max-delay-seconds: 300
    backoff-multiplier: 2.0
    dispatch-batch-size: 100
    clean-retention-days: 7
    consumption-dedup-days: 7

  # 对象存储配置：本地开发可以留空或使用测试环境配置
  storage:
    provider: ALIYUN_OSS
    aliyun:
      # OSS 配置（本地开发可留空，如需测试文件上传功能请填入）
      # 方式1：直接硬编码（仅本地开发，使用测试环境）
      endpoint: https://oss-cn-hangzhou.aliyuncs.com
      access-key-id: your_access_key_id
      access-key-secret: your_access_key_secret
      default-bucket: bluecone-dev
      # 方式2：使用环境变量（推荐）
      # endpoint: ${OSS_ENDPOINT:https://oss-cn-hangzhou.aliyuncs.com}
      # access-key-id: ${OSS_ACCESS_KEY_ID:your_access_key_id}
      # access-key-secret: ${OSS_ACCESS_KEY_SECRET:your_access_key_secret}
      # default-bucket: ${OSS_BUCKET:bluecone-dev}
      default-expire-seconds: 600
      cdn-domain: ${OSS_CDN_DOMAIN:https://cdn.bluecone.com}
      public-domain: ${OSS_PUBLIC_DOMAIN:https://img.bluecone.com}

  # 资源配额配置：本地开发可以使用默认配置
  resource:
    quota:
      default-daily-upload-count-limit: 2000
      default-daily-upload-bytes-limit: 10737418240
      tenant-overrides:
        1001:
          daily-upload-count-limit: 10000
          daily-upload-bytes-limit: 53687091200
        1002:
          daily-upload-count-limit: 500
          daily-upload-bytes-limit: 1073741824

  # 日志配置：本地开发可以启用详细日志
  log:
    enabled: false

  # ID 生成配置：本地开发可以使用默认配置
  id:
    long:
      enabled: true
      node-id: 1

# 日志级别配置：本地开发可以启用详细日志
logging:
  level:
    com.bluecone.app: DEBUG
    com.bluecone.app.infra.outbox: INFO
